name: Scheduled Sequential Incident Injects

on:
  schedule:
    - cron: "*/10 * * * *"  # Every 10 minutes
  workflow_dispatch:  # Allow manual runs

permissions:
  contents: read
  issues: write

jobs:
  create_sequential_issue:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Set up GitHub CLI
        run: |
          sudo apt-get update
          sudo apt-get install -y gh
          echo "${{ secrets.GITHUB_TOKEN }}" | gh auth login --with-token

      - name: Pick a random tabletop inject
        id: pick
        run: |
          injects=("Suspicious login from finance account"
                   "Privileged escalation detected on file server"
                   "Email gateway reports phishing message with attachment"
                   "Endpoint AV quarantined suspicious file"
                   "Azure AD conditional access bypass attempt"
                   "Firewall rule unexpectedly changed"
                   "Data exfiltration pattern detected in proxy logs"
                   "MFA disabled for key administrator account"
                   "Multiple failed logins detected from overseas IP")
          RANDOM_INDEX=$((RANDOM % ${#injects[@]}))
          echo "inject=${injects[$RANDOM_INDEX]}" >> $GITHUB_OUTPUT

      - name: Create GitHub Issue
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          gh issue create \
            --repo "${{ github.repository }}" \
            --title "ðŸš¨ Tabletop Alert - $(date +'%Y-%m-%d %H:%M UTC')" \
            --body "Incident Inject: ${{ steps.pick.outputs.inject }}" \
            --label "Tabletop,Alert"


