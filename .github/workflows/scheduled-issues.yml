name: Scheduled Sequential Incident Injects

on:
  schedule:
    - cron: "*/1 * * * *"  # Every 1 minutes (just for testing, change later)
  workflow_dispatch:

permissions:
  contents: read
  issues: write

jobs:
  create_sequential_issue:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Create GitHub Issue via API
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
          REPO: ${{ github.repository }}
        run: |
          injects=(
            "Suspicious login from finance account"
            "Privileged escalation detected on file server"
            "Email gateway reports phishing message with attachment"
            "Endpoint AV quarantined suspicious file"
            "Azure AD conditional access bypass attempt"
            "Firewall rule unexpectedly changed"
            "Data exfiltration pattern detected in proxy logs"
            "MFA disabled for key administrator account"
            "Multiple failed logins detected from overseas IP"
          )

          RANDOM_INDEX=$((RANDOM % ${#injects[@]}))
          TITLE="ðŸš¨ Tabletop Alert - $(date -u +'%Y-%m-%d %H:%M UTC')"
          BODY="Incident Inject: ${injects[$RANDOM_INDEX]}"

          # Use GitHub API instead of gh CLI for reliability
          curl -X POST \
            -H "Accept: application/vnd.github+json" \
            -H "Authorization: Bearer $GITHUB_TOKEN" \
            https://api.github.com/repos/$REPO/issues \
            -d "{\"title\":\"$TITLE\",\"body\":\"$BODY\",\"labels\":[\"Tabletop\",\"Alert\"]}"



